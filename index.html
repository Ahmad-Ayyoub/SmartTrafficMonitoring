  <!DOCTYPE html>
  <html>
  <head>
   <title>
    Smart Traffic Monitoring System
  </title>
  <link href="https://fonts.googleapis.com/css?family=Fredericka+the+Great" rel="stylesheet">
  <style type="text/css">

    body {
      display: flex;
      min-height: 100vh;
      width: 100%;
      padding: 0;
      margin: 0;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      background: url("./intersection.jpg") no-repeat center center fixed;
      background-size: cover;
    }

    div.boxes {
      filter: alpha(opacity=50);
      opacity: 0.5; 
      background-color: black;
      width: 860px; 
      height: 30%;
    }
    #snippet{
      filter: alpha(opacity=50);
      opacity: 0.5; 
      background-color: black;
    }

    #json {
      font-family: 'Fredericka the Great', cursive;
      font-size: 1em;
      margin-left: 30%;
      color: white;
    }

    #videoSrc{
      margin-left: 250px;
      margin-bottom: 15px;
    }
    code {
      font-family: 'Fredericka the Great', cursive;
      font-size: 1em;
      color: white;
    }

    #snippet:hover {
      filter: alpha(opacity=80);
      opacity: 0.8; 
      background-color: black;
    }

    #data:hover {
      filter: alpha(opacity=80);
      opacity: 0.8; 
      background-color: black;
    }

    #cameras{
      margin-bottom:  50px;
    }

    #cameras:hover{
      filter: alpha(opacity=80);
      opacity: 0.8; 
      background-color: black;
    }
    #head1,#head2 {
        margin: 0;
        font-family: 'Fredericka the Great', cursive;
        color: white;
        background-color: black;
    }

    .headers{
      margin:0;
      margin-top: 50px;
      font-family: 'Fredericka the Great', cursive;
      color: white;
      filter: alpha(opacity=80);
      opacity: 0.8; 
      background-color: black;
    }

  </style>
  <script src="https://www.gstatic.com/firebasejs/5.5.8/firebase.js"></script>
  <script>
      // Initialize Firebase
      var config = {
        apiKey: "AIzaSyDocIMJCv9ZfPq8ozvkeSc5PlC-X5gW5_k",
        authDomain: "smarttrafficmonitoring.firebaseapp.com",
        databaseURL: "https://smarttrafficmonitoring.firebaseio.com",
        projectId: "smarttrafficmonitoring",
        storageBucket: "smarttrafficmonitoring.appspot.com",
        messagingSenderId: "220108272524"
      };
      firebase.initializeApp(config);
      console.log(firebase);
      window.onload = function (){  
    
      var preObject = document.getElementById("json");
      var dbReferObj = firebase.database().ref().child('intersections');  
      dbReferObj.on('value', snap => {
        preObject.innerText = JSON.stringify(snap.val(), null, 3);
      });

      var storage = firebase.storage();
      var pathReference = storage.ref('yo.mp4');

      // Get the download URL
      pathReference.getDownloadURL().then(function(url) {
        var video = document.getElementById("videoSrc");
        video.src = url;
      }).catch(function(error) {

      // A full list of error codes is available at
      // https://firebase.google.com/docs/storage/web/handle-errors
      switch (error.code) {
        case 'storage/object-not-found':
          // File doesn't exist
          break;

          case 'storage/unauthorized':
          // User doesn't have permission to access the object
          break;

          case 'storage/canceled':
          // User canceled the upload
          break;

          case 'storage/unknown':
          // Unknown error occurred, inspect the server response
          break;
        }
      });
            }
</script>
</head>
<body>
  <h1 id="head1">Smart IoT-Based Traffic Monitorting System</h1>
  <h3 id="head2">Changing the way the traffic works</h3>
  <h1 class="headers">Our Intersection Status</h1>
  <div class = "boxes" id = "data">
    <pre id="json"></pre>
  </div>
  <h1 class="headers">Our Algorithm</h1>
  <div class = "boxes" id = "snippet">
    <pre> 
    <code>
    void TrafficLogic(int &carCountSouth, int &carCountEast, int carsSouth[], 
    int carsEast[], int &max, int &maxTime, boolean &leftGreenSouth, boolean 
    &leftGreenEast, boolean &loopLeftSouth, boolean &loopLeftEast) {
    time_t seconds = time(NULL)-startTime;
    
    time_t testTime = 7;
    if (seconds > yellowTime){
        if (!cycle) {
            greenTimeSN = countMaxTime(carsSouth, max, maxTime, leftGreenSouth,loopLeftSouth);
            greenTimeWE = countMaxTime(carsEast, max, maxTime, leftGreenEast, loopLeftEast);
            if (greenTimeSN > 0 || greenTimeWE > 0) {
                cycle = true;
            }
            else {
                cout << "No cars detected" << endl;
            }
        }
        else {
            if (!SNRedTrue) {
                greenTimeWE = countMaxTime(carsEast, max, maxTime, leftGreenEast,loopLeftEast);
                if (!alreadyPrinted) {
                    if (leftGreenSouth) {
                        NSGreenLeft = true;
                        NSGreenStraight = false;
                        WEGreenStraight = false;
                        WEGreenLeft = false;
                        //system("mosquitto_pub -h raspberrypi -t test -m \"4\"");
                        cout << "South and North Left are now Green for " << greenTimeSN << " seconds" << endl;
                        alreadyPrinted = true;
                    }
                    else {
                        NSGreenStraight = true;
                        NSGreenLeft = false;
                        WEGreenStraight = false;
                        WEGreenLeft = false;
                        //system("mosquitto_pub -h raspberrypi -t test -m \"0\"");
                        cout << "South and North are now Green for " << greenTimeSN << " seconds" << endl;
                        loopLeftSouth = true;
                        alreadyPrinted = true;
                    }                   
                }               
                if (seconds - yellowTime >= greenTimeSN) { // Set SN Red after the time for green (3*maxLaneCount)
                    if (leftGreenSouth) {
                        loopLeftSouth = false;
                        leftGreenSouth = false;
                        greenTimeSN = countMaxTime(carsSouth, max, maxTime, leftGreenSouth, loopLeftSouth);
                        
                        if (greenTimeSN != 0) {
                            startTime = time(NULL);
                        }
                        
                    }else {
                        if (greenTimeWE != 0) {
                            WEGreenStraight = false;
                            WEGreenLeft = false;
                            NSGreenLeft = false;
                            NSGreenStraight = false;
                            yellowTime = 3;
                            SNRedTrue = true;
                            WERedTrue = false;
                            waitStartTime = time(NULL);
                            cout << "South and North are now Yellow for " << yellowTime << " seconds" << endl;
                            //system("mosquitto_pub -h raspberrypi -t test -m \"2\"");
                            alreadyPrinted = false;
                        }
                        else {
                            yellowTime = 0;
                            greenTimeSN = countMaxTime(carsSouth, max, maxTime, leftGreenSouth,loopLeftSouth);
                            startTime = time(NULL);
                        }
                    }
                }
            }
            else if (!WERedTrue) {
                long waitEndTime = time(NULL);
                if (waitEndTime - waitStartTime >= yellowTime) {
                    int greenTimeSN2;
                    greenTimeSN2 = countMaxTime(carsSouth, max, maxTime, leftGreenSouth,loopLeftSouth);
                    if (!alreadyPrinted) {
                        if (leftGreenEast) {
                            NSGreenLeft = false;
                            NSGreenStraight = false;
                            WEGreenStraight = false;
                            WEGreenLeft = true;
                            //system("mosquitto_pub -h raspberrypi -t test -m \"5\"");
                            cout << "West and East Left are now Green for " << greenTimeWE << " seconds" << endl;
                            alreadyPrinted = true;
                        }
                        else {
                            NSGreenStraight = false;
                            NSGreenLeft = false;
                            WEGreenStraight = true;
                            WEGreenLeft = false;
                            loopLeftEast = true;
                            cout << "West and East are now green for " << greenTimeWE << " seconds" << endl;
                            //system("mosquitto_pub -h raspberrypi -t test -m \"1\"");
                            alreadyPrinted = true;
                        }
                    }
                    if (seconds - yellowTime - greenTimeSN - yellowTime >= greenTimeWE) {
                        if (leftGreenEast) {
                            loopLeftEast = false;
                            leftGreenEast = false;
                            int greenTimeWEOld = greenTimeWE;
                            greenTimeWE = countMaxTime(carsEast, max, maxTime, leftGreenEast, loopLeftEast);
                            if (greenTimeWE != 0) {
                                startTime += greenTimeWEOld;
                                waitStartTime = time(NULL);
                            }
                        }
                        else {
                            cout << "West and East are now yellow for " << yellowTime << " seconds" << endl;
                            if (seconds - yellowTime - greenTimeSN - yellowTime - greenTimeWE >= 0) {
                                if (greenTimeSN2 != 0) {
                                    yellowTime = 3;
                                    WERedTrue = true;
                                    SNRedTrue = false;
                                    cycle = false;
                                    startTime = time(NULL);
                                    greenTimeSN = greenTimeSN2;
                                    alreadyPrinted = false;
                                }
                                else {
                                    yellowTime = 0;
                                    greenTimeWE = countMaxTime(carsEast, max, maxTime, leftGreenEast, loopLeftEast);
                                    startTime = time(NULL);
                                }
                                
                            }                           
                        }                       
                    }
                }
            }
        }
    }
}
    </code>
  </pre>
  </div>
  <h1 class="headers">Our Live Cameras</h1>
  <div class = "boxes" id="cameras">
    <video id="videoSrc" width="320" height="240" controls>
    <source  src="" type="video/mp4">
    Your browser does not support the video tag.
    </video>
  </div>
</body>
</html>
